<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="cloudflare-rocket-loader" content="off">
    <title>LED Calculator API - æµ‹è¯•é¡µé¢</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 30px;
            border-radius: 16px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(102, 126, 234, 0.3);
        }
        .header h1 { font-size: 2.2rem; margin-bottom: 10px; font-weight: 700; }
        .header p { font-size: 1.1rem; opacity: 0.9; }
        .header-links {
            margin-top: 16px;
        }
        .header-links a {
            color: white;
            text-decoration: none;
            padding: 8px 16px;
            background: rgba(255,255,255,0.2);
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }
        .header-links a:hover { background: rgba(255,255,255,0.3); }
        .api-status {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
            padding: 10px 20px;
            background: rgba(255,255,255,0.15);
            border-radius: 30px;
        }
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ff4444;
            animation: pulse 2s infinite;
        }
        .status-indicator.online { background: #44ff44; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .tabs {
            display: flex;
            background: white;
            border-radius: 16px;
            padding: 8px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            gap: 8px;
        }
        .tab {
            flex: 1;
            padding: 14px 20px;
            border: none;
            background: transparent;
            cursor: pointer;
            border-radius: 12px;
            font-weight: 600;
            font-size: 15px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .tab.active { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        .tab:hover:not(.active) { background: #f0f0f0; }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .card {
            background: white;
            border-radius: 16px;
            padding: 28px;
            margin-bottom: 24px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        .card h2 { color: #333; margin-bottom: 8px; font-size: 1.4rem; display: flex; align-items: center; gap: 10px; }
        .card-subtitle { color: #6c757d; font-size: 14px; margin-bottom: 20px; }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 24px; }
        @media (max-width: 768px) { .form-grid { grid-template-columns: 1fr; } }
        .form-section { background: #f8f9fa; border-radius: 12px; padding: 20px; }
        .form-section h3 { font-size: 14px; color: #667eea; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 16px; font-weight: 600; }
        .form-group { margin-bottom: 16px; }
        .form-group:last-child { margin-bottom: 0; }
        .form-group label { display: block; margin-bottom: 6px; font-weight: 500; color: #555; font-size: 13px; }
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px 14px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: white;
        }
        .form-group input:focus, .form-group select:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1); }
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4); }
        .btn:disabled { background: #ccc; cursor: not-allowed; transform: none; box-shadow: none; }
        .btn-secondary { background: #6c757d; box-shadow: 0 4px 15px rgba(108, 117, 125, 0.3); }
        .btn-sm { padding: 8px 16px; font-size: 13px; }
        .loading { display: inline-block; width: 16px; height: 16px; border: 2px solid #ffffff; border-radius: 50%; border-top-color: transparent; animation: spin 0.8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .result-section { margin-top: 28px; }
        .result-card { background: linear-gradient(135deg, #f8f9fa 0%, #fff 100%); border: 1px solid #e9ecef; border-radius: 12px; padding: 20px; margin-bottom: 16px; }
        .result-card h3 { color: #495057; margin-bottom: 16px; font-size: 1rem; display: flex; align-items: center; gap: 8px; }
        .result-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; }
        .result-item { background: white; padding: 14px; border-radius: 10px; border-left: 4px solid #667eea; box-shadow: 0 2px 8px rgba(0,0,0,0.04); }
        .result-item .label { font-size: 11px; color: #6c757d; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px; }
        .result-item .value { font-size: 18px; font-weight: 700; color: #333; }
        .preview-container { background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border: 2px dashed #dee2e6; border-radius: 12px; padding: 20px; text-align: center; min-height: 400px; display: flex; align-items: center; justify-content: center; }
        .preview-container.has-content { border-style: solid; border-color: #667eea; }
        .preview-container svg { max-width: 100%; height: auto; }
        .error { background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%); color: #721c24; padding: 16px; border-radius: 12px; margin-bottom: 16px; }
        .success { background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%); color: #155724; padding: 16px; border-radius: 12px; margin-bottom: 16px; }
        .cabinet-info { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 8px; margin-top: 12px; font-size: 12px; color: #6c757d; background: white; padding: 12px; border-radius: 8px; }
        .cabinet-info div { padding: 4px 0; border-bottom: 1px solid #f0f0f0; }
        .multi-cabinet-section { border: 1px solid #e9ecef; border-radius: 10px; padding: 16px; margin-bottom: 12px; background: white; }
        .json-viewer { background: #1e1e1e; color: #d4d4d4; border-radius: 10px; padding: 16px; font-family: monospace; font-size: 12px; max-height: 300px; overflow-y: auto; white-space: pre-wrap; }
        .api-endpoint { background: linear-gradient(135deg, #e9ecef 0%, #f8f9fa 100%); padding: 8px 14px; border-radius: 8px; font-family: monospace; font-size: 12px; margin-bottom: 16px; display: inline-block; color: #667eea; font-weight: 500; }
        .checkbox-group { display: flex; gap: 20px; flex-wrap: wrap; margin-top: 8px; }
        .checkbox-item { display: flex; align-items: center; gap: 8px; background: white; padding: 10px 14px; border-radius: 8px; cursor: pointer; }
        .checkbox-item input[type="checkbox"] { width: 18px; height: 18px; accent-color: #667eea; }
        details { margin-top: 20px; }
        summary { cursor: pointer; font-weight: 600; color: #667eea; padding: 12px; background: #f8f9fa; border-radius: 8px; }
        .empty-state { text-align: center; padding: 40px; color: #6c757d; }
        .empty-state-icon { font-size: 48px; margin-bottom: 16px; opacity: 0.5; }
        .badge { display: inline-block; padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: 600; }
        .badge-success { background: #d4edda; color: #155724; }
        .badge-warning { background: #fff3cd; color: #856404; }
        .lang-switcher {
            display: inline-flex;
            gap: 8px;
            margin-top: 16px;
            background: rgba(255,255,255,0.15);
            padding: 6px;
            border-radius: 30px;
        }
        .lang-btn {
            background: transparent;
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 24px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .lang-btn:hover {
            background: rgba(255,255,255,0.2);
        }
        .lang-btn.active {
            background: rgba(255,255,255,0.3);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        /* Resolution preset buttons */
        .resolution-btn {
            padding: 10px 12px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            background: white;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #555;
        }
        .resolution-btn:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }
        .resolution-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: transparent;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        .resolution-info {
            padding: 10px 14px;
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            border-radius: 8px;
            font-size: 12px;
            color: #1565c0;
        }
        .resolution-info .target {
            font-weight: 600;
        }
        .resolution-info .actual {
            color: #7b1fa2;
            margin-left: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 data-i18n="header.title">ğŸ–¥ï¸ LED Calculator API</h1>
            <p data-i18n="header.subtitle">LEDæ˜¾ç¤ºå¢™è®¡ç®—ä¸é¢„è§ˆæµ‹è¯•å·¥å…·</p>
            <div class="header-links">
                <a href="/docs" data-i18n="header.viewDocs">ğŸ“š æŸ¥çœ‹APIæ–‡æ¡£</a>
                <a href="/vue-integration" style="margin-left: 8px;" data-i18n="header.vueIntegration">ğŸŸ¢ Vueé›†æˆä»£ç </a>
            </div>
            <div class="lang-switcher">
                <button class="lang-btn" data-lang="zh" onclick="i18n.setLanguage('zh')">
                    ğŸ‡¨ğŸ‡³ ä¸­æ–‡
                </button>
                <button class="lang-btn" data-lang="en" onclick="i18n.setLanguage('en')">
                    ğŸ‡ºğŸ‡¸ EN
                </button>
            </div>
            <div class="api-status">
                <span class="status-indicator" id="statusIndicator"></span>
                <span id="statusText" data-i18n="header.checkingStatus">æ£€æŸ¥APIçŠ¶æ€...</span>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('layout')" data-i18n="tabs.layout">ğŸ“ å•ç®±ä½“å¸ƒå±€</button>
            <button class="tab" onclick="switchTab('smart')" data-i18n="tabs.smart">ğŸ§© å¤šç®±ä½“ç»„åˆ</button>
            <button class="tab" onclick="switchTab('preview')" data-i18n="tabs.preview">ğŸ–¼ï¸ SVGé¢„è§ˆ</button>
            <button class="tab" onclick="switchTab('oneclick')" data-i18n="tabs.oneclick">âš¡ ä¸€é”®è®¡ç®—é¢„è§ˆ</button>
            
        </div>

        <!-- Optimal Layout Tab -->
        <div id="layout" class="tab-content active">
            <div class="card">
                <h2 data-i18n="layout.title">ğŸ“ å•ç®±ä½“æœ€ä¼˜å¸ƒå±€è®¡ç®—</h2>
                <p class="card-subtitle" data-i18n="layout.subtitle">åœ¨æŒ‡å®šå¢™é¢å°ºå¯¸å†…ï¼Œä½¿ç”¨å•ä¸€ç®±ä½“å‹å·æ‹¼æ¥LEDå±å¹•ï¼Œè‡ªåŠ¨è®¡ç®—æœ€ä¼˜çš„è¡Œåˆ—å¸ƒå±€</p>
                <div class="api-endpoint">POST /api/calculate/optimal-layout</div>
                <div class="form-grid">
                    <div class="form-section">
                        <h3 data-i18n="layout.cabinetSelection">ğŸ“¦ ç®±ä½“é€‰æ‹©</h3>
                        <div class="form-group">
                            <label data-i18n="layout.cabinetModel">ç®±ä½“å‹å·</label>
                            <select id="layoutCabinetSelect" onchange="updateLayoutCabinetInfo()" data-i18n-placeholder="layout.selectCabinet">
                                <option value="" data-i18n="layout.selectCabinet">è¯·é€‰æ‹©ç®±ä½“...</option>
                            </select>
                        </div>
                        <div id="layoutCabinetInfo"></div>
                    </div>
                    <div class="form-section">
                        <h3 data-i18n="layout.wallDimensions">ğŸ“ å¯ç”¨å¢™é¢å°ºå¯¸</h3>
                        <div class="form-group">
                            <label data-i18n="layout.wallWidth">å¢™é¢å®½åº¦</label>
                            <input type="number" id="layoutRoomWidth" value="5" step="0.1" min="0.1">
                        </div>
                        <div class="form-group">
                            <label data-i18n="layout.wallHeight">å¢™é¢é«˜åº¦</label>
                            <input type="number" id="layoutRoomHeight" value="3" step="0.1" min="0.1">
                        </div>
                        <div class="form-group">
                            <label data-i18n="layout.unit">å•ä½</label>
                            <select id="layoutUnit">
                                <option value="meters" data-i18n="layout.meters">ç±³ (Meters)</option>
                                <option value="feet" data-i18n="layout.feet">è‹±å°º (Feet)</option>
                            </select>
                        </div>
                    </div>
                </div>
                <button class="btn" onclick="calculateLayout()" id="layoutCalculateBtn">
                    <span class="loading" style="display: none;"></span>
                    <span data-i18n="layout.calculate">ğŸš€ è®¡ç®—æœ€ä¼˜å¸ƒå±€</span>
                </button>
                <div id="layoutResult" class="result-section"></div>
            </div>
        </div>

        <!-- Smart Combination Tab -->
        <div id="smart" class="tab-content">
            <div class="card">
                <h2 data-i18n="smart.title">ğŸ§© å¤šç®±ä½“æ™ºèƒ½ç»„åˆ</h2>
                <p class="card-subtitle" data-i18n="smart.subtitle">åœ¨æŒ‡å®šå¢™é¢å°ºå¯¸å†…ï¼Œä½¿ç”¨å¤šç§å°ºå¯¸ç®±ä½“ç»„åˆæ‹¼æ¥LEDå±å¹•ï¼Œæ™ºèƒ½è®¡ç®—æœ€ä½³å¡«å……æ–¹æ¡ˆ</p>
                <div class="api-endpoint">POST /api/calculate/smart-combination</div>
                <div class="form-grid">
                    <div class="form-section">
                        <h3 data-i18n="smart.mainCabinet">ğŸ¯ ä¸»ç®±ä½“</h3>
                        <div class="form-group">
                            <label data-i18n="smart.mainCabinetModel">ä¸»ç®±ä½“å‹å·</label>
                            <select id="smartMainCabinet" onchange="updateSmartMainInfo()">
                                <option value="" data-i18n="smart.selectMainCabinet">è¯·é€‰æ‹©ä¸»ç®±ä½“...</option>
                            </select>
                        </div>
                        <div id="smartMainCabinetInfo"></div>
                    </div>
                    <div class="form-section">
                        <h3 data-i18n="smart.wallDimensionsMm">ğŸ“ å¯ç”¨å¢™é¢å°ºå¯¸ (æ¯«ç±³)</h3>
                        <div class="form-group">
                            <label data-i18n="smart.wallWidthMm">å¢™é¢å®½åº¦ (mm)</label>
                            <input type="number" id="smartWallWidth" value="4300" min="100">
                        </div>
                        <div class="form-group">
                            <label data-i18n="smart.wallHeightMm">å¢™é¢é«˜åº¦ (mm)</label>
                            <input type="number" id="smartWallHeight" value="3300" min="100">
                        </div>
                    </div>
                </div>
                <div class="form-section" style="margin-bottom: 24px;">
                    <h3 data-i18n="smart.auxiliaryCabinets">â• è¾…åŠ©ç®±ä½“</h3>
                    <div id="smartAuxiliaryList"></div>
                    <button class="btn btn-secondary btn-sm" onclick="addAuxiliaryCabinet()" style="margin-top:12px;" data-i18n="smart.addAuxiliary">+ æ·»åŠ è¾…åŠ©ç®±ä½“</button>
                </div>
                <button class="btn" onclick="calculateSmart()" id="smartCalculateBtn">
                    <span class="loading" style="display: none;"></span>
                    <span data-i18n="smart.calculate">ğŸ” è®¡ç®—æœ€ä¼˜ç»„åˆ</span>
                </button>
                <div id="smartResult" class="result-section"></div>
            </div>
        </div>

        

        <!-- Preview Tab -->
        <div id="preview" class="tab-content">
            <div class="card">
                <h2 data-i18n="preview.title">ğŸ–¼ï¸ SVGé¢„è§ˆç”Ÿæˆå™¨</h2>
                <p class="card-subtitle" data-i18n="preview.subtitle">åŸºäºè®¡ç®—ç»“æœç”ŸæˆLEDå±å¹•çš„å¯è§†åŒ–é¢„è§ˆå›¾ï¼Œå±•ç¤ºç®±ä½“æ’åˆ—æ•ˆæœ</p>
                <div class="api-endpoint">POST /api/preview/svg</div>
                <div class="form-grid">
                    <div class="form-section">
                        <h3 data-i18n="preview.previewOptions">âš™ï¸ é¢„è§ˆé€‰é¡¹</h3>
                        <div class="form-group">
                            <label data-i18n="preview.canvasWidth">ç”»å¸ƒå®½åº¦ (px)</label>
                            <input type="number" id="previewWidth" value="800" min="100">
                        </div>
                        <div class="form-group">
                            <label data-i18n="preview.canvasHeight">ç”»å¸ƒé«˜åº¦ (px)</label>
                            <input type="number" id="previewHeight" value="500" min="100">
                        </div>
                        <div class="checkbox-group">
                            <label class="checkbox-item">
                                <input type="checkbox" id="previewShowDimensions" checked>
                                <span data-i18n="preview.showDimensions">æ˜¾ç¤ºå°ºå¯¸æ ‡æ³¨</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" id="previewShowPerson" checked>
                                <span data-i18n="preview.showPerson">æ˜¾ç¤ºäººç‰©å‚ç…§</span>
                            </label>
                        </div>
                    </div>
                    <div class="form-section">
                        <h3 data-i18n="preview.dataSource">ğŸ“Š æ•°æ®æ¥æº</h3>
                        <p style="color:#6c757d;font-size:13px;margin-bottom:12px;" data-i18n="preview.dataSourceHint">è¯·å…ˆå®Œæˆè®¡ç®—ï¼Œç„¶åé€‰æ‹©æ•°æ®æ¥æºç”Ÿæˆé¢„è§ˆ</p>
                        <div class="form-group">
                            <label data-i18n="preview.selectResult">é€‰æ‹©è®¡ç®—ç»“æœ</label>
                            <select id="previewSource">
                                <option value="" data-i18n="preview.noResults">æš‚æ— å¯ç”¨çš„è®¡ç®—ç»“æœ</option>
                            </select>
                        </div>
                        <div id="previewSourceInfo" style="margin-top:12px;"></div>
                    </div>
                </div>
                <button class="btn" onclick="generatePreview()" id="previewGenerateBtn" disabled>
                    <span class="loading" style="display: none;"></span>
                    <span data-i18n="preview.generate">ğŸ¨ ç”ŸæˆSVGé¢„è§ˆ</span>
                </button>
                <div id="previewResult" class="result-section">
                    <div class="preview-container" id="previewContainer">
                        <div class="empty-state">
                            <div class="empty-state-icon">ğŸ–¼ï¸</div>
                            <p data-i18n="preview.noPreview">æš‚æ— é¢„è§ˆå›¾</p>
                            <p style="font-size:13px;margin-top:8px;" data-i18n="preview.noPreviewHint">è¯·å…ˆå®Œæˆè®¡ç®—ï¼Œç„¶åç”Ÿæˆé¢„è§ˆ</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- One-Click Calculate + Preview Tab -->
        <div id="oneclick" class="tab-content">
            <div class="card">
                <h2 data-i18n="oneclick.title">âš¡ ä¸€é”®è®¡ç®— + é¢„è§ˆ</h2>
                <p class="card-subtitle" data-i18n="oneclick.subtitle">è¾“å…¥ç®±ä½“å’Œå¢™é¢ä¿¡æ¯ï¼Œä¸€æ¬¡è¯·æ±‚åŒæ—¶è¿”å›è®¡ç®—ç»“æœå’ŒSVGé¢„è§ˆå›¾</p>
                
                <!-- æ¨¡å¼åˆ‡æ¢ -->
                <div style="display:flex;gap:12px;margin-bottom:20px;">
                    <button class="btn" id="oneclickModeSingle" onclick="switchOneclickMode('single')" style="flex:1;">
                        <span data-i18n="oneclick.modeSingle">ğŸ“ å•ç®±ä½“æ¨¡å¼</span>
                    </button>
                    <button class="btn btn-secondary" id="oneclickModeMulti" onclick="switchOneclickMode('multi')" style="flex:1;">
                        <span data-i18n="oneclick.modeMulti">ğŸ§© å¤šç®±ä½“æ¨¡å¼</span>
                    </button>
                </div>
                <div class="api-endpoint" id="oneclickApiEndpoint">POST /api/calculate/optimal-layout-with-preview</div>
                
                <div class="form-grid">
                    <div class="form-section">
                        <h3 data-i18n="oneclick.cabinetSelection">ğŸ“¦ ç®±ä½“é€‰æ‹©</h3>
                        <div class="form-group">
                            <label data-i18n="oneclick.cabinetModel">ç®±ä½“å‹å·</label>
                            <select id="oneclickMainCabinet" onchange="updateOneclickMainInfo()">
                                <option value="" data-i18n="oneclick.selectCabinet">è¯·é€‰æ‹©ç®±ä½“...</option>
                            </select>
                        </div>
                        <div id="oneclickMainCabinetInfo"></div>
                        <div class="form-group" style="margin-top:16px;" id="oneclickAutoAuxGroup">
                            <label>
                                <input type="checkbox" id="oneclickAutoAux" checked style="width:auto;margin-right:8px;">
                                <span data-i18n="oneclick.autoAux">è‡ªåŠ¨æ·»åŠ åŒç³»åˆ—è¾…åŠ©ç®±ä½“ (å¤šç®±ä½“æ¨¡å¼)</span>
                            </label>
                        </div>
                    </div>
                    <div class="form-section">
                        <h3 data-i18n="oneclick.wallDimensions">ğŸ“ å¯ç”¨å¢™é¢å°ºå¯¸</h3>
                        <!-- ğŸ¯ åˆ†è¾¨ç‡é¢„è®¾é€‰æ‹© (ä»…å•ç®±ä½“æ¨¡å¼) -->
                        <div class="form-group" id="oneclickResolutionGroup">
                            <label data-i18n="oneclick.resolution">åˆ†è¾¨ç‡é¢„è®¾</label>
                            <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-top:8px;">
                                <button type="button" class="resolution-btn active" data-resolution="Custom" onclick="selectResolution('Custom')">Custom</button>
                                <button type="button" class="resolution-btn" data-resolution="FHD" onclick="selectResolution('FHD')">FHD</button>
                                <button type="button" class="resolution-btn" data-resolution="UHD" onclick="selectResolution('UHD')">UHD</button>
                                <button type="button" class="resolution-btn" data-resolution="8K" onclick="selectResolution('8K')">8K</button>
                            </div>
                            <div id="oneclickResolutionInfo" style="margin-top:8px;"></div>
                        </div>
                        <div class="form-group" id="oneclickWallWidthGroup">
                            <label data-i18n="oneclick.wallWidth">å¢™é¢å®½åº¦</label>
                            <input type="number" id="oneclickWallWidth" value="5" step="0.1" min="0.1">
                        </div>
                        <div class="form-group" id="oneclickWallHeightGroup">
                            <label data-i18n="oneclick.wallHeight">å¢™é¢é«˜åº¦</label>
                            <input type="number" id="oneclickWallHeight" value="3" step="0.1" min="0.1">
                        </div>
                        <div class="form-group">
                            <label data-i18n="oneclick.unit">å•ä½</label>
                            <select id="oneclickUnit">
                                <option value="meters" data-i18n="oneclick.meters">ç±³ (Meters)</option>
                                <option value="feet" data-i18n="oneclick.feet">è‹±å°º (Feet)</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="form-section" style="margin-bottom: 24px;">
                    <h3 data-i18n="oneclick.previewOptions">âš™ï¸ é¢„è§ˆé€‰é¡¹</h3>
                    <div class="checkbox-group">
                        <label class="checkbox-item">
                            <input type="checkbox" id="oneclickShowDimensions" checked>
                            <span data-i18n="oneclick.showDimensions">æ˜¾ç¤ºå°ºå¯¸æ ‡æ³¨</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" id="oneclickShowPerson" checked>
                            <span data-i18n="oneclick.showPerson">æ˜¾ç¤ºäººç‰©å‚ç…§</span>
                        </label>
                    </div>
                </div>
                <button class="btn" onclick="calculateOneClick()" id="oneclickCalculateBtn">
                    <span class="loading" style="display: none;"></span>
                    <span data-i18n="oneclick.calculate">âš¡ ä¸€é”®è®¡ç®—å¹¶ç”Ÿæˆé¢„è§ˆ</span>
                </button>
                <div id="oneclickResult" class="result-section"></div>
            </div>
        </div>
    </div>

    <script data-cfasync="false">
        // ==================== i18n å›½é™…åŒ–æ¨¡å— ====================
        const i18n = {
            currentLang: 'zh',
            
            translations: {
                zh: {
                    header: {
                        title: 'LED Calculator API',
                        subtitle: 'LEDæ˜¾ç¤ºå¢™è®¡ç®—ä¸é¢„è§ˆæµ‹è¯•å·¥å…·',
                        viewDocs: 'ğŸ“š æŸ¥çœ‹APIæ–‡æ¡£',
                        vueIntegration: 'ğŸŸ¢ Vueé›†æˆä»£ç ',
                        apiStatus: 'APIçŠ¶æ€',
                        checkingStatus: 'æ£€æŸ¥APIçŠ¶æ€...',
                        online: 'API åœ¨çº¿',
                        offline: 'API ç¦»çº¿ - è¯·å¯åŠ¨: npm run dev',
                        error: 'API é”™è¯¯'
                    },
                    tabs: {
                        layout: 'ğŸ“ å•ç®±ä½“å¸ƒå±€',
                        smart: 'ğŸ§© å¤šç®±ä½“ç»„åˆ',
                        preview: 'ğŸ–¼ï¸ SVGé¢„è§ˆ',
                        oneclick: 'âš¡ ä¸€é”®è®¡ç®—é¢„è§ˆ'
                    },
                    layout: {
                        title: 'ğŸ“ å•ç®±ä½“æœ€ä¼˜å¸ƒå±€è®¡ç®—',
                        subtitle: 'åœ¨æŒ‡å®šå¢™é¢å°ºå¯¸å†…ï¼Œä½¿ç”¨å•ä¸€ç®±ä½“å‹å·æ‹¼æ¥LEDå±å¹•ï¼Œè‡ªåŠ¨è®¡ç®—æœ€ä¼˜çš„è¡Œåˆ—å¸ƒå±€',
                        cabinetSelection: 'ğŸ“¦ ç®±ä½“é€‰æ‹©',
                        cabinetModel: 'ç®±ä½“å‹å·',
                        selectCabinet: 'è¯·é€‰æ‹©ç®±ä½“...',
                        wallDimensions: 'ğŸ“ å¯ç”¨å¢™é¢å°ºå¯¸',
                        wallWidth: 'å¢™é¢å®½åº¦',
                        wallHeight: 'å¢™é¢é«˜åº¦',
                        unit: 'å•ä½',
                        meters: 'ç±³ (Meters)',
                        feet: 'è‹±å°º (Feet)',
                        calculate: 'ğŸš€ è®¡ç®—æœ€ä¼˜å¸ƒå±€',
                        calculating: 'è®¡ç®—ä¸­...'
                    },
                    smart: {
                        title: 'ğŸ§© å¤šç®±ä½“æ™ºèƒ½ç»„åˆ',
                        subtitle: 'åœ¨æŒ‡å®šå¢™é¢å°ºå¯¸å†…ï¼Œä½¿ç”¨å¤šç§å°ºå¯¸ç®±ä½“ç»„åˆæ‹¼æ¥LEDå±å¹•ï¼Œæ™ºèƒ½è®¡ç®—æœ€ä½³å¡«å……æ–¹æ¡ˆ',
                        mainCabinet: 'ğŸ¯ ä¸»ç®±ä½“',
                        mainCabinetModel: 'ä¸»ç®±ä½“å‹å·',
                        selectMainCabinet: 'è¯·é€‰æ‹©ä¸»ç®±ä½“...',
                        wallDimensionsMm: 'ğŸ“ å¯ç”¨å¢™é¢å°ºå¯¸ (æ¯«ç±³)',
                        wallWidthMm: 'å¢™é¢å®½åº¦ (mm)',
                        wallHeightMm: 'å¢™é¢é«˜åº¦ (mm)',
                        auxiliaryCabinets: 'â• è¾…åŠ©ç®±ä½“',
                        addAuxiliary: '+ æ·»åŠ è¾…åŠ©ç®±ä½“',
                        auxiliaryCabinet: 'è¾…åŠ©ç®±ä½“',
                        remove: 'ç§»é™¤',
                        calculate: 'ğŸ” è®¡ç®—æœ€ä¼˜ç»„åˆ',
                        autoAdded: 'âœ… å·²è‡ªåŠ¨æ·»åŠ '
                    },
                    preview: {
                        title: 'ğŸ–¼ï¸ SVGé¢„è§ˆç”Ÿæˆå™¨',
                        subtitle: 'åŸºäºè®¡ç®—ç»“æœç”ŸæˆLEDå±å¹•çš„å¯è§†åŒ–é¢„è§ˆå›¾ï¼Œå±•ç¤ºç®±ä½“æ’åˆ—æ•ˆæœ',
                        previewOptions: 'âš™ï¸ é¢„è§ˆé€‰é¡¹',
                        canvasWidth: 'ç”»å¸ƒå®½åº¦ (px)',
                        canvasHeight: 'ç”»å¸ƒé«˜åº¦ (px)',
                        showDimensions: 'æ˜¾ç¤ºå°ºå¯¸æ ‡æ³¨',
                        showPerson: 'æ˜¾ç¤ºäººç‰©å‚ç…§',
                        dataSource: 'ğŸ“Š æ•°æ®æ¥æº',
                        dataSourceHint: 'è¯·å…ˆå®Œæˆè®¡ç®—ï¼Œç„¶åé€‰æ‹©æ•°æ®æ¥æºç”Ÿæˆé¢„è§ˆ',
                        selectResult: 'é€‰æ‹©è®¡ç®—ç»“æœ',
                        noResults: 'æš‚æ— å¯ç”¨çš„è®¡ç®—ç»“æœ',
                        generate: 'ğŸ¨ ç”ŸæˆSVGé¢„è§ˆ',
                        noPreview: 'æš‚æ— é¢„è§ˆå›¾',
                        noPreviewHint: 'è¯·å…ˆå®Œæˆè®¡ç®—ï¼Œç„¶åç”Ÿæˆé¢„è§ˆ'
                    },
                    oneclick: {
                        title: 'âš¡ ä¸€é”®è®¡ç®— + é¢„è§ˆ',
                        subtitle: 'è¾“å…¥ç®±ä½“å’Œå¢™é¢ä¿¡æ¯ï¼Œä¸€æ¬¡è¯·æ±‚åŒæ—¶è¿”å›è®¡ç®—ç»“æœå’ŒSVGé¢„è§ˆå›¾',
                        modeSingle: 'ğŸ“ å•ç®±ä½“æ¨¡å¼',
                        modeMulti: 'ğŸ§© å¤šç®±ä½“æ¨¡å¼',
                        cabinetSelection: 'ğŸ“¦ ç®±ä½“é€‰æ‹©',
                        cabinetModel: 'ç®±ä½“å‹å·',
                        selectCabinet: 'è¯·é€‰æ‹©ç®±ä½“...',
                        autoAux: 'è‡ªåŠ¨æ·»åŠ åŒç³»åˆ—è¾…åŠ©ç®±ä½“ (å¤šç®±ä½“æ¨¡å¼)',
                        wallDimensions: 'ğŸ“ å¯ç”¨å¢™é¢å°ºå¯¸',
                        resolution: 'åˆ†è¾¨ç‡é¢„è®¾',
                        resolutionCustom: 'ğŸ’¡ è‡ªå®šä¹‰æ¨¡å¼ï¼šæ ¹æ®å¢™é¢å°ºå¯¸è‡ªåŠ¨è®¡ç®—æœ€ä¼˜å¸ƒå±€',
                        resolutionTarget: 'ğŸ¯ ç›®æ ‡åˆ†è¾¨ç‡',
                        resolutionActual: 'å®é™…åˆ†è¾¨ç‡',
                        resolutionAuto: '(è‡ªåŠ¨è®¡ç®—å¢™é¢å°ºå¯¸)',
                        wallWidth: 'å¢™é¢å®½åº¦',
                        wallHeight: 'å¢™é¢é«˜åº¦',
                        unit: 'å•ä½',
                        meters: 'ç±³ (Meters)',
                        feet: 'è‹±å°º (Feet)',
                        previewOptions: 'âš™ï¸ é¢„è§ˆé€‰é¡¹',
                        showDimensions: 'æ˜¾ç¤ºå°ºå¯¸æ ‡æ³¨',
                        showPerson: 'æ˜¾ç¤ºäººç‰©å‚ç…§',
                        calculate: 'âš¡ ä¸€é”®è®¡ç®—å¹¶ç”Ÿæˆé¢„è§ˆ',
                        calculating: 'â³ æ­£åœ¨è®¡ç®—å¹¶ç”Ÿæˆé¢„è§ˆ...'
                    },
                    results: {
                        columns: 'åˆ—æ•°',
                        rows: 'è¡Œæ•°',
                        totalCabinets: 'ç®±ä½“æ€»æ•°',
                        screenWidth: 'å®½åº¦',
                        screenHeight: 'é«˜åº¦',
                        screenArea: 'é¢ç§¯',
                        coverage: 'è¦†ç›–ç‡',
                        fullyFilled: 'å®Œå…¨å¡«å……',
                        yes: 'æ˜¯',
                        no: 'å¦',
                        testCombinations: 'æµ‹è¯•ç»„åˆæ•°',
                        cabinetDetails: 'ğŸ“¦ ç®±ä½“æ•°é‡æ˜ç»†',
                        pieces: 'ä¸ª',
                        layoutRecommendation: 'ğŸ“ æ¨èå¸ƒå±€',
                        screenDimensions: 'ğŸ“º å±å¹•å°ºå¯¸',
                        resolutionInfo: 'ğŸ–¥ï¸ åˆ†è¾¨ç‡ä¿¡æ¯',
                        totalWidth: 'æ€»å®½åº¦',
                        totalHeight: 'æ€»é«˜åº¦',
                        totalPixels: 'æ€»åƒç´ ',
                        physicalParams: 'âš¡ ç‰©ç†å‚æ•°',
                        totalWeight: 'æ€»é‡é‡',
                        maxPower: 'æœ€å¤§åŠŸç‡',
                        typicalPower: 'å…¸å‹åŠŸç‡',
                        structuralLoad: 'ç»“æ„è´Ÿè½½',
                        availableWall: 'ğŸ“ å¯ç”¨å¢™é¢',
                        optimalCombination: 'ğŸ¯ æœ€ä¼˜ç»„åˆæ–¹æ¡ˆ',
                        powerConsumption: 'âš¡ åŠŸè€—ä¸ç‰©ç†å‚æ•°',
                        svgPreview: 'ğŸ–¼ï¸ SVGé¢„è§ˆ',
                        viewJson: 'æŸ¥çœ‹åŸå§‹JSONå“åº”',
                        success: 'è®¡ç®—å®Œæˆï¼',
                        layoutSuccess: 'æœ€ä¼˜å¸ƒå±€è®¡ç®—å®Œæˆï¼',
                        smartSuccess: 'æ™ºèƒ½ç»„åˆåˆ†æå®Œæˆï¼',
                        singleSuccess: 'å•ç®±ä½“ä¸€é”®è®¡ç®—å®Œæˆï¼',
                        multiSuccess: 'å¤šç®±ä½“ä¸€é”®è®¡ç®—å®Œæˆï¼',
                        previewFailed: 'é¢„è§ˆç”Ÿæˆå¤±è´¥',
                        generationFailed: 'ç”Ÿæˆå¤±è´¥',
                        networkError: 'ç½‘ç»œé”™è¯¯',
                        selectCabinetError: 'è¯·é€‰æ‹©ç®±ä½“å‹å·',
                        selectMainCabinetError: 'è¯·é€‰æ‹©ä¸»ç®±ä½“',
                        selectAuxiliaryError: 'è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªè¾…åŠ©ç®±ä½“',
                        noAuxiliaryError: 'æ²¡æœ‰å¯ç”¨çš„è¾…åŠ©ç®±ä½“ï¼Œè¯·é€‰æ‹©æœ‰åŒç³»åˆ—ç®±ä½“çš„äº§å“',
                        selectResultError: 'è¯·å…ˆé€‰æ‹©è®¡ç®—ç»“æœ',
                        calculationFailed: 'è®¡ç®—å¤±è´¥',
                        hasResults: 'âœ… å·²æœ‰',
                        resultsAvailable: 'ä¸ªè®¡ç®—ç»“æœå¯ç”¨',
                        pleaseCalculate: 'âš ï¸ è¯·å…ˆå®Œæˆè®¡ç®—ä»¥è·å–æ•°æ®'
                    },
                    cabinet: {
                        dimensions: 'å°ºå¯¸',
                        pixelPitch: 'åƒç´ é—´è·',
                        resolution: 'åˆ†è¾¨ç‡',
                        brightness: 'äº®åº¦',
                        weight: 'é‡é‡',
                        maxPower: 'æœ€å¤§åŠŸç‡',
                        uslimSeries: 'ğŸ”¥ UslimIII MIP 1.5 ç³»åˆ—',
                        uminiSeries: 'âœ¨ UMiniW 0.9 ç³»åˆ—'
                    }
                },
                en: {
                    header: {
                        title: 'LED Calculator API',
                        subtitle: 'LED Display Wall Calculation & Preview Testing Tool',
                        viewDocs: 'ğŸ“š View API Docs',
                        vueIntegration: 'ğŸŸ¢ Vue Integration',
                        apiStatus: 'API Status',
                        checkingStatus: 'Checking API status...',
                        online: 'API Online',
                        offline: 'API Offline - Please start: npm run dev',
                        error: 'API Error'
                    },
                    tabs: {
                        layout: 'ğŸ“ Single Cabinet Layout',
                        smart: 'ğŸ§© Multi-Cabinet Combination',
                        preview: 'ğŸ–¼ï¸ SVG Preview',
                        oneclick: 'âš¡ One-Click Calculate'
                    },
                    layout: {
                        title: 'ğŸ“ Optimal Single Cabinet Layout',
                        subtitle: 'Calculate the optimal row and column layout for LED screen assembly using a single cabinet model within specified wall dimensions',
                        cabinetSelection: 'ğŸ“¦ Cabinet Selection',
                        cabinetModel: 'Cabinet Model',
                        selectCabinet: 'Please select cabinet...',
                        wallDimensions: 'ğŸ“ Available Wall Dimensions',
                        wallWidth: 'Wall Width',
                        wallHeight: 'Wall Height',
                        unit: 'Unit',
                        meters: 'Meters',
                        feet: 'Feet',
                        calculate: 'ğŸš€ Calculate Optimal Layout',
                        calculating: 'Calculating...'
                    },
                    smart: {
                        title: 'ğŸ§© Smart Multi-Cabinet Combination',
                        subtitle: 'Intelligently calculate the best filling solution using multiple cabinet sizes within specified wall dimensions',
                        mainCabinet: 'ğŸ¯ Main Cabinet',
                        mainCabinetModel: 'Main Cabinet Model',
                        selectMainCabinet: 'Please select main cabinet...',
                        wallDimensionsMm: 'ğŸ“ Available Wall Dimensions (mm)',
                        wallWidthMm: 'Wall Width (mm)',
                        wallHeightMm: 'Wall Height (mm)',
                        auxiliaryCabinets: 'â• Auxiliary Cabinets',
                        addAuxiliary: '+ Add Auxiliary Cabinet',
                        auxiliaryCabinet: 'Auxiliary Cabinet',
                        remove: 'Remove',
                        calculate: 'ğŸ” Calculate Optimal Combination',
                        autoAdded: 'âœ… Auto-added'
                    },
                    preview: {
                        title: 'ğŸ–¼ï¸ SVG Preview Generator',
                        subtitle: 'Generate visual preview of LED screen based on calculation results, showing cabinet arrangement',
                        previewOptions: 'âš™ï¸ Preview Options',
                        canvasWidth: 'Canvas Width (px)',
                        canvasHeight: 'Canvas Height (px)',
                        showDimensions: 'Show Dimensions',
                        showPerson: 'Show Person Reference',
                        dataSource: 'ğŸ“Š Data Source',
                        dataSourceHint: 'Please complete calculation first, then select data source to generate preview',
                        selectResult: 'Select Calculation Result',
                        noResults: 'No calculation results available',
                        generate: 'ğŸ¨ Generate SVG Preview',
                        noPreview: 'No Preview Available',
                        noPreviewHint: 'Please complete calculation first, then generate preview'
                    },
                    oneclick: {
                        title: 'âš¡ One-Click Calculate + Preview',
                        subtitle: 'Enter cabinet and wall information, get calculation results and SVG preview in one request',
                        modeSingle: 'ğŸ“ Single Cabinet Mode',
                        modeMulti: 'ğŸ§© Multi-Cabinet Mode',
                        cabinetSelection: 'ğŸ“¦ Cabinet Selection',
                        cabinetModel: 'Cabinet Model',
                        selectCabinet: 'Please select cabinet...',
                        autoAux: 'Auto-add same series auxiliary cabinets (Multi-cabinet mode)',
                        wallDimensions: 'ğŸ“ Available Wall Dimensions',
                        resolution: 'Resolution Preset',
                        resolutionCustom: 'ğŸ’¡ Custom Mode: Auto-calculate optimal layout based on wall dimensions',
                        resolutionTarget: 'ğŸ¯ Target Resolution',
                        resolutionActual: 'Actual Resolution',
                        resolutionAuto: '(Auto-calculate wall size)',
                        wallWidth: 'Wall Width',
                        wallHeight: 'Wall Height',
                        unit: 'Unit',
                        meters: 'Meters',
                        feet: 'Feet',
                        previewOptions: 'âš™ï¸ Preview Options',
                        showDimensions: 'Show Dimensions',
                        showPerson: 'Show Person Reference',
                        calculate: 'âš¡ One-Click Calculate & Preview',
                        calculating: 'â³ Calculating and generating preview...'
                    },
                    results: {
                        columns: 'Columns',
                        rows: 'Rows',
                        totalCabinets: 'Total Cabinets',
                        screenWidth: 'Width',
                        screenHeight: 'Height',
                        screenArea: 'Area',
                        coverage: 'Coverage',
                        fullyFilled: 'Fully Filled',
                        yes: 'Yes',
                        no: 'No',
                        testCombinations: 'Test Combinations',
                        cabinetDetails: 'ğŸ“¦ Cabinet Quantity Details',
                        pieces: 'pcs',
                        layoutRecommendation: 'ğŸ“ Recommended Layout',
                        screenDimensions: 'ğŸ“º Screen Dimensions',
                        resolutionInfo: 'ğŸ–¥ï¸ Resolution Info',
                        totalWidth: 'Total Width',
                        totalHeight: 'Total Height',
                        totalPixels: 'Total Pixels',
                        physicalParams: 'âš¡ Physical Parameters',
                        totalWeight: 'Total Weight',
                        maxPower: 'Max Power',
                        typicalPower: 'Typical Power',
                        structuralLoad: 'Structural Load',
                        availableWall: 'ğŸ“ Available Wall',
                        optimalCombination: 'ğŸ¯ Optimal Combination',
                        powerConsumption: 'âš¡ Power & Physical Parameters',
                        svgPreview: 'ğŸ–¼ï¸ SVG Preview',
                        viewJson: 'View Raw JSON Response',
                        success: 'Calculation Complete!',
                        layoutSuccess: 'Optimal layout calculation complete!',
                        smartSuccess: 'Smart combination analysis complete!',
                        singleSuccess: 'Single cabinet one-click calculation complete!',
                        multiSuccess: 'Multi-cabinet one-click calculation complete!',
                        previewFailed: 'Preview generation failed',
                        generationFailed: 'Generation failed',
                        networkError: 'Network error',
                        selectCabinetError: 'Please select cabinet model',
                        selectMainCabinetError: 'Please select main cabinet',
                        selectAuxiliaryError: 'Please select at least one auxiliary cabinet',
                        noAuxiliaryError: 'No auxiliary cabinets available, please select a product with same series cabinets',
                        selectResultError: 'Please select calculation result first',
                        calculationFailed: 'Calculation failed',
                        hasResults: 'âœ… Available:',
                        resultsAvailable: 'calculation result(s)',
                        pleaseCalculate: 'âš ï¸ Please complete calculation first to get data'
                    },
                    cabinet: {
                        dimensions: 'Dimensions',
                        pixelPitch: 'Pixel Pitch',
                        resolution: 'Resolution',
                        brightness: 'Brightness',
                        weight: 'Weight',
                        maxPower: 'Max Power',
                        uslimSeries: 'ğŸ”¥ UslimIII MIP 1.5 Series',
                        uminiSeries: 'âœ¨ UMiniW 0.9 Series'
                    }
                }
            },
            
            // Get translation by key path (e.g., 'header.title')
            t(key, params = {}) {
                const keys = key.split('.');
                let value = this.translations[this.currentLang];
                for (const k of keys) {
                    value = value?.[k];
                    if (value === undefined) break;
                }
                
                // If translation not found, return key
                if (value === undefined) {
                    console.warn(`Translation missing for key: ${key} (${this.currentLang})`);
                    return key;
                }
                
                // Replace parameters in template strings
                if (typeof value === 'string' && Object.keys(params).length > 0) {
                    return value.replace(/\{\{(\w+)\}\}/g, (match, param) => {
                        return params[param] !== undefined ? params[param] : match;
                    });
                }
                
                return value;
            },
            
            // Set language and update DOM
            setLanguage(lang) {
                if (lang !== 'zh' && lang !== 'en') {
                    console.warn(`Invalid language: ${lang}, defaulting to zh`);
                    lang = 'zh';
                }
                this.currentLang = lang;
                localStorage.setItem('led-calculator-lang', lang);
                this.updateDOM();
                this.updateLanguageSwitcher();
            },
            
            // Update all translatable elements in DOM
            updateDOM() {
                // Update elements with data-i18n attribute
                document.querySelectorAll('[data-i18n]').forEach(el => {
                    const key = el.getAttribute('data-i18n');
                    el.textContent = this.t(key);
                });
                
                // Update elements with data-i18n-placeholder attribute
                document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                    const key = el.getAttribute('data-i18n-placeholder');
                    el.placeholder = this.t(key);
                });
                
                // Update elements with data-i18n-title attribute
                document.querySelectorAll('[data-i18n-title]').forEach(el => {
                    const key = el.getAttribute('data-i18n-title');
                    el.title = this.t(key);
                });
                
                // Update page title and lang attribute
                document.title = `LED Calculator API - ${this.currentLang === 'zh' ? 'æµ‹è¯•é¡µé¢' : 'Test Page'}`;
                document.documentElement.lang = this.currentLang === 'zh' ? 'zh-CN' : 'en';
            },
            
            // Update language switcher button states
            updateLanguageSwitcher() {
                document.querySelectorAll('.lang-btn').forEach(btn => {
                    const btnLang = btn.getAttribute('data-lang');
                    if (btnLang === this.currentLang) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
            },
            
            // Initialize i18n on page load
            init() {
                // Try to get language from localStorage
                const savedLang = localStorage.getItem('led-calculator-lang');
                if (savedLang) {
                    this.currentLang = savedLang;
                } else {
                    // Detect browser language
                    const browserLang = navigator.language || navigator.userLanguage;
                    this.currentLang = browserLang.startsWith('zh') ? 'zh' : 'en';
                }
                
                this.updateDOM();
                this.updateLanguageSwitcher();
            }
        };
        
        // å…¨å±€å˜é‡
        // è‡ªåŠ¨æ£€æµ‹å½“å‰åŸŸåï¼Œå¦‚æœæ˜¯ localhost åˆ™ä½¿ç”¨ localhost:3001ï¼Œå¦åˆ™ä½¿ç”¨å½“å‰åŸŸå
        let apiBaseUrl = window.location.hostname === 'localhost' 
            ? 'http://localhost:3001' 
            : window.location.origin;
        let calculationResults = {};

        // äº§å“æ•°æ® - åªåŒ…å« UslimIII MIP 1.5 å’Œ UMiniW 0.9 ä¸¤æ¬¾äº§å“
        const cabinetData = [
            // ========== UslimIII MIP 1.5 ç³»åˆ— (6ç§å°ºå¯¸) ==========
            {
                id: "uslimiii-mip-15-500x1000",
                name: "UslimIII MIP 1.5 (500Ã—1000)",
                family: "UslimIII",
                dimensions: { width: 500, height: 1000, depth: 40 },
                display: { pixelPitch: 1.5625, resolution: { width: 320, height: 640 }, brightness: 1000, refreshRate: 5760 },
                power: { maxPower: 180, typicalPower: 60, standbyPower: 5 },
                physical: { weight: 10.5 }
            },
            {
                id: "uslimiii-mip-15-500x500",
                name: "UslimIII MIP 1.5 (500Ã—500)",
                family: "UslimIII",
                dimensions: { width: 500, height: 500, depth: 40 },
                display: { pixelPitch: 1.5625, resolution: { width: 320, height: 320 }, brightness: 1000, refreshRate: 5760 },
                power: { maxPower: 90, typicalPower: 30, standbyPower: 3 },
                physical: { weight: 5.4 }
            },
            {
                id: "uslimiii-mip-15-500x250",
                name: "UslimIII MIP 1.5 (500Ã—250)",
                family: "UslimIII",
                dimensions: { width: 500, height: 250, depth: 40 },
                display: { pixelPitch: 1.5625, resolution: { width: 320, height: 160 }, brightness: 1000, refreshRate: 5760 },
                power: { maxPower: 45, typicalPower: 15, standbyPower: 2 },
                physical: { weight: 3.5 }
            },
            {
                id: "uslimiii-mip-15-250x500",
                name: "UslimIII MIP 1.5 (250Ã—500)",
                family: "UslimIII",
                dimensions: { width: 250, height: 500, depth: 40 },
                display: { pixelPitch: 1.5625, resolution: { width: 160, height: 320 }, brightness: 1000, refreshRate: 5760 },
                power: { maxPower: 45, typicalPower: 15, standbyPower: 2 },
                physical: { weight: 3.5 }
            },
            {
                id: "uslimiii-mip-15-250x750",
                name: "UslimIII MIP 1.5 (250Ã—750)",
                family: "UslimIII",
                dimensions: { width: 250, height: 750, depth: 40 },
                display: { pixelPitch: 1.5625, resolution: { width: 160, height: 480 }, brightness: 1000, refreshRate: 5760 },
                power: { maxPower: 67.5, typicalPower: 22.5, standbyPower: 2 },
                physical: { weight: 4.5 }
            },
            {
                id: "uslimiii-mip-15-750x250",
                name: "UslimIII MIP 1.5 (750Ã—250)",
                family: "UslimIII",
                dimensions: { width: 750, height: 250, depth: 40 },
                display: { pixelPitch: 1.5625, resolution: { width: 480, height: 160 }, brightness: 1000, refreshRate: 5760 },
                power: { maxPower: 67.5, typicalPower: 22.5, standbyPower: 2 },
                physical: { weight: 4.5 }
            },
            // ========== UMiniW 0.9 ç³»åˆ— (2ç§å°ºå¯¸) ==========
            {
                id: "uminiw-09-600x337",
                name: "UMiniW 0.9 (600Ã—337.5)",
                family: "UMiniW",
                dimensions: { width: 600, height: 337.5, depth: 29.8 },
                display: { pixelPitch: 0.9375, resolution: { width: 640, height: 360 }, brightness: 600, refreshRate: 3840 },
                power: { maxPower: 60, typicalPower: 42, standbyPower: 3 },
                physical: { weight: 4.3 }
            },
            {
                id: "uminiw-09-300x337",
                name: "UMiniW 0.9 (300Ã—337.5)",
                family: "UMiniW",
                dimensions: { width: 300, height: 337.5, depth: 29.8 },
                display: { pixelPitch: 0.9375, resolution: { width: 320, height: 360 }, brightness: 600, refreshRate: 3840 },
                power: { maxPower: 30, typicalPower: 21, standbyPower: 2 },
                physical: { weight: 2.5 }
            }
        ];

        // é¡µé¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            i18n.init();
            checkApiStatus();
            populateCabinetSelects();
            // åˆå§‹åŒ–ä¸€é”®è®¡ç®—æ¨¡å¼ä¸ºå•ç®±ä½“
            switchOneclickMode('single');
        });

        async function checkApiStatus() {
            const statusIndicator = document.getElementById('statusIndicator');
            const statusText = document.getElementById('statusText');
            try {
                const response = await fetch(`${apiBaseUrl}/health`);
                if (response.ok) {
                    statusIndicator.classList.add('online');
                    statusText.textContent = i18n.t('header.online');
                } else {
                    statusText.textContent = i18n.t('header.error');
                }
            } catch (error) {
                statusText.textContent = i18n.t('header.offline');
            }
        }

        function populateCabinetSelects() {
            const selects = ['layoutCabinetSelect', 'smartMainCabinet', 'oneclickMainCabinet'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    const placeholderKey = selectId === 'smartMainCabinet' ? 'smart.selectMainCabinet' : 
                                          selectId === 'oneclickMainCabinet' ? 'oneclick.selectCabinet' : 'layout.selectCabinet';
                    select.innerHTML = `<option value="">${i18n.t(placeholderKey)}</option>`;
                    
                    // UslimIII ç³»åˆ—
                    const uslimGroup = cabinetData.filter(c => c.family === 'UslimIII');
                    if (uslimGroup.length > 0) {
                        const optgroup = document.createElement('optgroup');
                        optgroup.label = i18n.t('cabinet.uslimSeries');
                        uslimGroup.forEach(cabinet => {
                            const option = document.createElement('option');
                            option.value = cabinet.id;
                            option.textContent = cabinet.name;
                            optgroup.appendChild(option);
                        });
                        select.appendChild(optgroup);
                    }
                    
                    // UMiniW ç³»åˆ—
                    const uminiGroup = cabinetData.filter(c => c.family === 'UMiniW');
                    if (uminiGroup.length > 0) {
                        const optgroup = document.createElement('optgroup');
                        optgroup.label = i18n.t('cabinet.uminiSeries');
                        uminiGroup.forEach(cabinet => {
                            const option = document.createElement('option');
                            option.value = cabinet.id;
                            option.textContent = cabinet.name;
                            optgroup.appendChild(option);
                        });
                        select.appendChild(optgroup);
                    }
                }
            });
        }

        function getSameFamilyCabinets(mainCabinetId) {
            const mainCabinet = getCabinetById(mainCabinetId);
            if (!mainCabinet) return [];
            return cabinetData.filter(c => c.id !== mainCabinetId && c.family === mainCabinet.family);
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            event.target.closest('.tab').classList.add('active');
        }

        function getCabinetById(id) {
            return cabinetData.find(c => c.id === id);
        }

        function formatCabinetInfo(cabinet) {
            if (!cabinet) return '';
            return `
                <div class="cabinet-info">
                    <div><strong>${i18n.t('cabinet.dimensions')}:</strong> ${cabinet.dimensions.width}Ã—${cabinet.dimensions.height}mm</div>
                    <div><strong>${i18n.t('cabinet.pixelPitch')}:</strong> ${cabinet.display.pixelPitch}mm</div>
                    <div><strong>${i18n.t('cabinet.resolution')}:</strong> ${cabinet.display.resolution.width}Ã—${cabinet.display.resolution.height}</div>
                    <div><strong>${i18n.t('cabinet.brightness')}:</strong> ${cabinet.display.brightness} nits</div>
                    <div><strong>${i18n.t('cabinet.weight')}:</strong> ${cabinet.physical.weight} kg</div>
                    <div><strong>${i18n.t('cabinet.maxPower')}:</strong> ${cabinet.power.maxPower}W</div>
                </div>
            `;
        }

        function updateLayoutCabinetInfo() {
            const cabinet = getCabinetById(document.getElementById('layoutCabinetSelect').value);
            document.getElementById('layoutCabinetInfo').innerHTML = formatCabinetInfo(cabinet);
        }

        function updateSmartMainInfo() {
            const mainCabinetId = document.getElementById('smartMainCabinet').value;
            const cabinet = getCabinetById(mainCabinetId);
            document.getElementById('smartMainCabinetInfo').innerHTML = formatCabinetInfo(cabinet);
            
            if (cabinet) {
                const sameFamilyCabinets = getSameFamilyCabinets(mainCabinetId);
                if (sameFamilyCabinets.length > 0) {
                    const container = document.getElementById('smartAuxiliaryList');
                    container.innerHTML = '';
                    sameFamilyCabinets.forEach((auxCabinet) => {
                        addAuxiliaryCabinetWithValue(auxCabinet.id);
                    });
                    const autoAddedMsg = i18n.currentLang === 'zh' ? 
                        `${i18n.t('smart.autoAdded')} ${sameFamilyCabinets.length} ä¸ªåŒç³»åˆ—è¾…åŠ©ç®±ä½“` :
                        `${i18n.t('smart.autoAdded')} ${sameFamilyCabinets.length} same series auxiliary cabinets`;
                    document.getElementById('smartMainCabinetInfo').innerHTML += `
                        <div style="margin-top:12px;padding:10px;background:#e8f5e9;border-radius:8px;color:#2e7d32;font-size:12px;">
                            ${autoAddedMsg}
                        </div>
                    `;
                }
            }
        }

        function addAuxiliaryCabinetWithValue(cabinetId) {
            const container = document.getElementById('smartAuxiliaryList');
            const index = container.children.length;
            const cabinet = getCabinetById(cabinetId);
            
            const div = document.createElement('div');
            div.className = 'multi-cabinet-section';
            div.innerHTML = `
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
                    <strong>${i18n.t('smart.auxiliaryCabinet')} ${index + 1}</strong>
                    <button class="btn btn-secondary btn-sm" onclick="this.parentElement.parentElement.remove()">${i18n.t('smart.remove')}</button>
                </div>
                <div class="form-group" style="margin-bottom:0;">
                    <label>${i18n.t('smart.mainCabinetModel')}</label>
                    <select class="auxiliary-cabinet-select">
                        <option value="">${i18n.t('smart.selectMainCabinet')}</option>
                        ${cabinetData.map(c => `<option value="${c.id}" ${c.id === cabinetId ? 'selected' : ''}>${c.name}</option>`).join('')}
                    </select>
                </div>
                ${cabinet ? `<div style="margin-top:8px;font-size:12px;color:#6c757d;">${i18n.t('cabinet.dimensions')}: ${cabinet.dimensions.width}Ã—${cabinet.dimensions.height}mm</div>` : ''}
            `;
            container.appendChild(div);
        }

        function addAuxiliaryCabinet() {
            const container = document.getElementById('smartAuxiliaryList');
            const index = container.children.length;
            const div = document.createElement('div');
            div.className = 'multi-cabinet-section';
            div.innerHTML = `
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
                    <strong>${i18n.t('smart.auxiliaryCabinet')} ${index + 1}</strong>
                    <button class="btn btn-secondary btn-sm" onclick="this.parentElement.parentElement.remove()">${i18n.t('smart.remove')}</button>
                </div>
                <div class="form-group" style="margin-bottom:0;">
                    <label>${i18n.t('smart.mainCabinetModel')}</label>
                    <select class="auxiliary-cabinet-select">
                        <option value="">${i18n.t('smart.selectMainCabinet')}</option>
                        ${cabinetData.map(c => `<option value="${c.id}">${c.name}</option>`).join('')}
                    </select>
                </div>
            `;
            container.appendChild(div);
        }

        function showError(container, message) {
            container.innerHTML = `<div class="error">âŒ ${message}</div>`;
        }

        function showSuccess(message) {
            return `<div class="success">âœ… ${message}</div>`;
        }

        function convertToApiFormat(cabinet) {
            return {
                dimensions: cabinet.dimensions,
                display: {
                    pixelPitch: cabinet.display.pixelPitch,
                    resolution: cabinet.display.resolution,
                    brightness: cabinet.display.brightness,
                    refreshRate: cabinet.display.refreshRate,
                    colorDepth: 16
                },
                power: {
                    maxPower: cabinet.power.maxPower,
                    typicalPower: cabinet.power.typicalPower,
                    standbyPower: cabinet.power.standbyPower || 5
                },
                physical: {
                    weight: cabinet.physical.weight,
                    operatingTemp: { min: 0, max: 45 },
                    humidity: { min: 10, max: 90 },
                    ipRating: "IP30"
                },
                installation: {
                    mountingType: ["wall", "floor"],
                    cableType: ["power", "data"],
                    maintenanceAccess: "front"
                }
            };
        }

        // ==================== Optimal Layout è®¡ç®— ====================
        async function calculateLayout() {
            const btn = document.getElementById('layoutCalculateBtn');
            const loading = btn.querySelector('.loading');
            const resultDiv = document.getElementById('layoutResult');

            const cabinetId = document.getElementById('layoutCabinetSelect').value;
            if (!cabinetId) {
                showError(resultDiv, i18n.t('results.selectCabinetError'));
                return;
            }

            const cabinet = getCabinetById(cabinetId);
            btn.disabled = true;
            loading.style.display = 'inline-block';

            try {
                const requestData = {
                    cabinetSpecs: convertToApiFormat(cabinet),
                    roomConfig: {
                        dimensions: {
                            width: parseFloat(document.getElementById('layoutRoomWidth').value),
                            height: parseFloat(document.getElementById('layoutRoomHeight').value)
                        },
                        unit: document.getElementById('layoutUnit').value,
                        wallType: 'flat'
                    }
                };

                const response = await fetch(`${apiBaseUrl}/api/calculate/optimal-layout`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestData)
                });

                const result = await response.json();
                if (result.success) {
                    calculationResults.layout = {
                        result: result.data,
                        roomConfig: requestData.roomConfig,
                        cabinet: cabinet,
                        cabinetSpecs: requestData.cabinetSpecs
                    };
                    displayLayoutResult(result.data, resultDiv, cabinet);
                    updatePreviewSources();
                } else {
                    showError(resultDiv, result.error?.message || i18n.t('results.calculationFailed'));
                }
            } catch (error) {
                showError(resultDiv, `${i18n.t('results.networkError')}: ${error.message}`);
            } finally {
                btn.disabled = false;
                loading.style.display = 'none';
            }
        }

        function displayLayoutResult(data, container, cabinet) {
            const totalCabinets = data.columns * data.rows;
            const wallWidthM = (cabinet.dimensions.width * data.columns) / 1000;
            const wallHeightM = (cabinet.dimensions.height * data.rows) / 1000;
            const wallArea = wallWidthM * wallHeightM;
            const totalPixelsW = cabinet.display.resolution.width * data.columns;
            const totalPixelsH = cabinet.display.resolution.height * data.rows;
            const totalWeight = cabinet.physical.weight * totalCabinets;
            const maxPower = cabinet.power.maxPower * totalCabinets;

            container.innerHTML = showSuccess('æœ€ä¼˜å¸ƒå±€è®¡ç®—å®Œæˆï¼') + `
                <div class="result-card">
                    <h3>ğŸ“ æ¨èå¸ƒå±€</h3>
                    <div class="result-grid">
                        <div class="result-item"><div class="label">åˆ—æ•°</div><div class="value">${data.columns}</div></div>
                        <div class="result-item"><div class="label">è¡Œæ•°</div><div class="value">${data.rows}</div></div>
                        <div class="result-item"><div class="label">ç®±ä½“æ€»æ•°</div><div class="value">${totalCabinets}</div></div>
                    </div>
                </div>
                <div class="result-card">
                    <h3>ï¿½ å±å¹•å°ºå°ºå¯¸</h3>
                    <div class="result-grid">
                        <div class="result-item"><div class="label">å®½åº¦</div><div class="value">${wallWidthM.toFixed(2)} m</div></div>
                        <div class="result-item"><div class="label">é«˜åº¦</div><div class="value">${wallHeightM.toFixed(2)} m</div></div>
                        <div class="result-item"><div class="label">é¢ç§¯</div><div class="value">${wallArea.toFixed(2)} mÂ²</div></div>
                    </div>
                </div>
                <div class="result-card">
                    <h3>ğŸ–¥ï¸ åˆ†è¾¨ç‡ä¿¡æ¯</h3>
                    <div class="result-grid">
                        <div class="result-item"><div class="label">æ€»å®½åº¦</div><div class="value">${totalPixelsW.toLocaleString()} px</div></div>
                        <div class="result-item"><div class="label">æ€»é«˜åº¦</div><div class="value">${totalPixelsH.toLocaleString()} px</div></div>
                        <div class="result-item"><div class="label">æ€»åƒç´ </div><div class="value">${(totalPixelsW * totalPixelsH).toLocaleString()}</div></div>
                    </div>
                </div>
                <div class="result-card">
                    <h3>âš¡ ç‰©ç†å‚æ•°</h3>
                    <div class="result-grid">
                        <div class="result-item"><div class="label">æ€»é‡é‡</div><div class="value">${totalWeight.toFixed(1)} kg</div></div>
                        <div class="result-item"><div class="label">æœ€å¤§åŠŸç‡</div><div class="value">${maxPower.toLocaleString()} W</div></div>
                        <div class="result-item"><div class="label">ç»“æ„è´Ÿè½½</div><div class="value">${(totalWeight / wallArea).toFixed(1)} kg/mÂ²</div></div>
                    </div>
                </div>
                <details>
                    <summary>æŸ¥çœ‹åŸå§‹JSONå“åº”</summary>
                    <div class="json-viewer">${JSON.stringify(data, null, 2)}</div>
                </details>
            `;
        }

        // ==================== Smart Combination è®¡ç®— ====================
        async function calculateSmart() {
            const btn = document.getElementById('smartCalculateBtn');
            const loading = btn.querySelector('.loading');
            const resultDiv = document.getElementById('smartResult');

            const mainCabinetId = document.getElementById('smartMainCabinet').value;
            if (!mainCabinetId) {
                showError(resultDiv, 'è¯·é€‰æ‹©ä¸»ç®±ä½“');
                return;
            }

            const auxiliaryCabinets = [];
            document.querySelectorAll('.auxiliary-cabinet-select').forEach(select => {
                if (select.value) {
                    const cabinet = getCabinetById(select.value);
                    auxiliaryCabinets.push({
                        id: cabinet.id,
                        specs: convertToApiFormat(cabinet)
                    });
                }
            });

            if (auxiliaryCabinets.length === 0) {
                showError(resultDiv, 'è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªè¾…åŠ©ç®±ä½“');
                return;
            }

            btn.disabled = true;
            loading.style.display = 'inline-block';

            try {
                const mainCabinet = getCabinetById(mainCabinetId);
                const requestData = {
                    mainCabinet: {
                        id: mainCabinet.id,
                        specs: convertToApiFormat(mainCabinet)
                    },
                    auxiliaryCabinets: auxiliaryCabinets,
                    wallWidthMm: parseInt(document.getElementById('smartWallWidth').value),
                    wallHeightMm: parseInt(document.getElementById('smartWallHeight').value)
                };

                const response = await fetch(`${apiBaseUrl}/api/calculate/smart-combination`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestData)
                });

                const result = await response.json();
                if (result.success) {
                    const calcResult = result.data.calculationResult;
                    const wallWidthM = calcResult.wallDimensions.width;
                    const wallHeightM = calcResult.wallDimensions.height;
                    
                    // ä¿å­˜åŸå§‹å¢™é¢å°ºå¯¸
                    const inputWallWidth = requestData.wallWidthMm;
                    const inputWallHeight = requestData.wallHeightMm;
                    
                    calculationResults.smart = {
                        result: calcResult,
                        roomConfig: {
                            dimensions: { width: inputWallWidth / 1000, height: inputWallHeight / 1000 },
                            unit: 'meters',
                            wallType: 'flat'
                        },
                        rawData: result.data,
                        inputWall: { width: inputWallWidth, height: inputWallHeight }
                    };
                    displaySmartResult(result.data, resultDiv, inputWallWidth, inputWallHeight);
                    updatePreviewSources();
                } else {
                    showError(resultDiv, result.error?.message || 'è®¡ç®—å¤±è´¥');
                }
            } catch (error) {
                showError(resultDiv, `ç½‘ç»œé”™è¯¯: ${error.message}`);
            } finally {
                btn.disabled = false;
                loading.style.display = 'none';
            }
        }

        function displaySmartResult(data, container, inputWallWidthMm, inputWallHeightMm) {
            const calcResult = data.calculationResult || {};
            const inputWallWidthM = (inputWallWidthMm / 1000).toFixed(2);
            const inputWallHeightM = (inputWallHeightMm / 1000).toFixed(2);
            
            container.innerHTML = showSuccess('æ™ºèƒ½ç»„åˆåˆ†æå®Œæˆï¼') + `
                <div class="result-card">
                    <h3>ğŸ“ å¯ç”¨å¢™é¢</h3>
                    <div class="result-grid">
                        <div class="result-item"><div class="label">å®½åº¦</div><div class="value">${inputWallWidthM} m</div></div>
                        <div class="result-item"><div class="label">é«˜åº¦</div><div class="value">${inputWallHeightM} m</div></div>
                    </div>
                </div>
                <div class="result-card">
                    <h3>ğŸ¯ æœ€ä¼˜ç»„åˆæ–¹æ¡ˆ</h3>
                    <div class="result-grid">
                        <div class="result-item">
                            <div class="label">è¦†ç›–ç‡</div>
                            <div class="value">${data.coveragePercentage || 'N/A'}</div>
                        </div>
                        <div class="result-item">
                            <div class="label">å®Œå…¨å¡«å……</div>
                            <div class="value">
                                <span class="badge ${data.isFullyFilled ? 'badge-success' : 'badge-warning'}">
                                    ${data.isFullyFilled ? 'æ˜¯' : 'å¦'}
                                </span>
                            </div>
                        </div>
                        <div class="result-item">
                            <div class="label">æµ‹è¯•ç»„åˆæ•°</div>
                            <div class="value">${data.testResultsCount || 0}</div>
                        </div>
                    </div>
                </div>
                ${data.bestCombination ? `
                <div class="result-card">
                    <h3>ğŸ“¦ ç®±ä½“æ•°é‡æ˜ç»†</h3>
                    <div class="result-grid">
                        ${data.bestCombination.map(cab => {
                            const cabinet = getCabinetById(cab.id);
                            return `<div class="result-item">
                                <div class="label">${cabinet ? cabinet.name : cab.id}</div>
                                <div class="value">${cab.count} ä¸ª</div>
                            </div>`;
                        }).join('')}
                    </div>
                </div>
                ` : ''}
                ${calcResult.wallDimensions ? `
                <div class="result-card">
                    <h3>ğŸ“º å±å¹•å°ºå¯¸</h3>
                    <div class="result-grid">
                        <div class="result-item"><div class="label">å®½åº¦</div><div class="value">${calcResult.wallDimensions.width.toFixed(2)} m</div></div>
                        <div class="result-item"><div class="label">é«˜åº¦</div><div class="value">${calcResult.wallDimensions.height.toFixed(2)} m</div></div>
                        <div class="result-item"><div class="label">é¢ç§¯</div><div class="value">${calcResult.wallDimensions.area.toFixed(2)} mÂ²</div></div>
                    </div>
                </div>
                ` : ''}
                ${calcResult.powerConsumption ? `
                <div class="result-card">
                    <h3>âš¡ åŠŸè€—ä¸ç‰©ç†å‚æ•°</h3>
                    <div class="result-grid">
                        <div class="result-item"><div class="label">æœ€å¤§åŠŸç‡</div><div class="value">${calcResult.powerConsumption.maximum.toLocaleString()} W</div></div>
                        <div class="result-item"><div class="label">å…¸å‹åŠŸç‡</div><div class="value">${calcResult.powerConsumption.typical.toLocaleString()} W</div></div>
                        <div class="result-item"><div class="label">æ€»é‡é‡</div><div class="value">${calcResult.physical?.totalWeight?.toFixed(1) || 'N/A'} kg</div></div>
                    </div>
                </div>
                ` : ''}
                <details>
                    <summary>æŸ¥çœ‹åŸå§‹JSONå“åº”</summary>
                    <div class="json-viewer">${JSON.stringify(data, null, 2)}</div>
                </details>
            `;
        }

        // ==================== One-Click ä¸€é”®è®¡ç®—+é¢„è§ˆ ====================
        let oneclickMode = 'single'; // 'single' or 'multi'
        let selectedResolution = 'Custom'; // 'Custom', 'FHD', 'UHD', '8K'
        
        // åˆ†è¾¨ç‡é¢„è®¾å®šä¹‰
        const RESOLUTION_PRESETS = {
            'FHD': { width: 1920, height: 1080, name: 'Full HD (1080p)' },
            'UHD': { width: 3840, height: 2160, name: '4K Ultra HD' },
            '8K': { width: 7680, height: 4320, name: '8K Ultra HD' }
        };

        function switchOneclickMode(mode) {
            oneclickMode = mode;
            const singleBtn = document.getElementById('oneclickModeSingle');
            const multiBtn = document.getElementById('oneclickModeMulti');
            const autoAuxGroup = document.getElementById('oneclickAutoAuxGroup');
            const apiEndpoint = document.getElementById('oneclickApiEndpoint');
            const resolutionGroup = document.getElementById('oneclickResolutionGroup');
            
            if (mode === 'single') {
                singleBtn.className = 'btn';
                multiBtn.className = 'btn btn-secondary';
                autoAuxGroup.style.display = 'none';
                resolutionGroup.style.display = 'block';
                apiEndpoint.textContent = 'POST /api/calculate/optimal-layout-with-preview';
                // æ›´æ–°åˆ†è¾¨ç‡ä¿¡æ¯æ˜¾ç¤º
                updateResolutionInfo();
            } else {
                singleBtn.className = 'btn btn-secondary';
                multiBtn.className = 'btn';
                autoAuxGroup.style.display = 'block';
                resolutionGroup.style.display = 'none';
                apiEndpoint.textContent = 'POST /api/calculate/smart-combination-with-preview';
            }
        }
        
        // é€‰æ‹©åˆ†è¾¨ç‡é¢„è®¾
        function selectResolution(resolution) {
            selectedResolution = resolution;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.resolution-btn').forEach(btn => {
                if (btn.getAttribute('data-resolution') === resolution) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            // æ›´æ–°å¢™é¢å°ºå¯¸è¾“å…¥æ¡†çŠ¶æ€
            const wallWidthInput = document.getElementById('oneclickWallWidth');
            const wallHeightInput = document.getElementById('oneclickWallHeight');
            const wallWidthGroup = document.getElementById('oneclickWallWidthGroup');
            const wallHeightGroup = document.getElementById('oneclickWallHeightGroup');
            
            if (resolution === 'Custom') {
                // Customæ¨¡å¼ï¼šå¯ç”¨å¢™é¢å°ºå¯¸è¾“å…¥
                wallWidthInput.disabled = false;
                wallHeightInput.disabled = false;
                wallWidthGroup.style.opacity = '1';
                wallHeightGroup.style.opacity = '1';
            } else {
                // é¢„è®¾åˆ†è¾¨ç‡æ¨¡å¼ï¼šç¦ç”¨å¢™é¢å°ºå¯¸è¾“å…¥ï¼ˆè‡ªåŠ¨è®¡ç®—ï¼‰
                wallWidthInput.disabled = true;
                wallHeightInput.disabled = true;
                wallWidthGroup.style.opacity = '0.6';
                wallHeightGroup.style.opacity = '0.6';
            }
            
            updateResolutionInfo();
        }
        
        // æ›´æ–°åˆ†è¾¨ç‡ä¿¡æ¯æ˜¾ç¤º
        function updateResolutionInfo() {
            const infoDiv = document.getElementById('oneclickResolutionInfo');
            const cabinetId = document.getElementById('oneclickMainCabinet').value;
            const cabinet = getCabinetById(cabinetId);
            
            if (selectedResolution === 'Custom') {
                infoDiv.innerHTML = `<div class="resolution-info">${i18n.t('oneclick.resolutionCustom')}</div>`;
                return;
            }
            
            const preset = RESOLUTION_PRESETS[selectedResolution];
            if (!preset) return;
            
            if (!cabinet) {
                infoDiv.innerHTML = `<div class="resolution-info">
                    <span class="target">${i18n.t('oneclick.resolutionTarget')}: ${preset.width}Ã—${preset.height}px (${preset.name})</span>
                    <br><span style="color:#e65100;font-size:11px;">âš ï¸ ${i18n.t('oneclick.selectCabinet')}</span>
                </div>`;
                return;
            }
            
            // è®¡ç®—å®é™…åˆ†è¾¨ç‡
            const cabinetRes = cabinet.display.resolution;
            const columns = Math.ceil(preset.width / cabinetRes.width);
            const rows = Math.ceil(preset.height / cabinetRes.height);
            const actualWidth = cabinetRes.width * columns;
            const actualHeight = cabinetRes.height * rows;
            
            // è®¡ç®—å¢™é¢å°ºå¯¸
            const wallWidthM = (cabinet.dimensions.width * columns) / 1000;
            const wallHeightM = (cabinet.dimensions.height * rows) / 1000;
            
            infoDiv.innerHTML = `<div class="resolution-info">
                <span class="target">${i18n.t('oneclick.resolutionTarget')}: ${preset.width}Ã—${preset.height}px</span>
                <span class="actual">| ${i18n.t('oneclick.resolutionActual')}: ${actualWidth}Ã—${actualHeight}px</span>
                <br><span style="font-size:11px;color:#555;">ğŸ“ ${columns}Ã—${rows} = ${columns * rows} ${i18n.t('cabinet.dimensions').split(':')[0]} | ${wallWidthM.toFixed(2)}m Ã— ${wallHeightM.toFixed(2)}m ${i18n.t('oneclick.resolutionAuto')}</span>
            </div>`;
        }

        function updateOneclickMainInfo() {
            const mainCabinetId = document.getElementById('oneclickMainCabinet').value;
            const cabinet = getCabinetById(mainCabinetId);
            document.getElementById('oneclickMainCabinetInfo').innerHTML = formatCabinetInfo(cabinet);
            // æ›´æ–°åˆ†è¾¨ç‡ä¿¡æ¯ï¼ˆå½“é€‰æ‹©ç®±ä½“æ—¶ï¼‰
            if (oneclickMode === 'single') {
                updateResolutionInfo();
            }
        }

        async function calculateOneClick() {
            const btn = document.getElementById('oneclickCalculateBtn');
            const loading = btn.querySelector('.loading');
            const resultDiv = document.getElementById('oneclickResult');

            const mainCabinetId = document.getElementById('oneclickMainCabinet').value;
            if (!mainCabinetId) {
                showError(resultDiv, 'è¯·é€‰æ‹©ç®±ä½“å‹å·');
                return;
            }

            const mainCabinet = getCabinetById(mainCabinetId);
            const unit = document.getElementById('oneclickUnit').value;
            
            // è·å–å¢™é¢å°ºå¯¸
            let wallWidth = parseFloat(document.getElementById('oneclickWallWidth').value);
            let wallHeight = parseFloat(document.getElementById('oneclickWallHeight').value);

            btn.disabled = true;
            loading.style.display = 'inline-block';
            resultDiv.innerHTML = '<div style="text-align:center;padding:20px;color:#6c757d;">â³ æ­£åœ¨è®¡ç®—å¹¶ç”Ÿæˆé¢„è§ˆ...</div>';

            try {
                const showDimensions = document.getElementById('oneclickShowDimensions').checked;
                const showPerson = document.getElementById('oneclickShowPerson').checked;

                if (oneclickMode === 'single') {
                    // å•ç®±ä½“æ¨¡å¼
                    const requestData = {
                        cabinetSpecs: convertToApiFormat(mainCabinet),
                        roomConfig: {
                            dimensions: { width: wallWidth, height: wallHeight },
                            unit: unit,
                            wallType: 'flat'
                        },
                        // ğŸ¯ æ·»åŠ åˆ†è¾¨ç‡é¢„è®¾å‚æ•°
                        targetResolution: selectedResolution,
                        previewOptions: {
                            showDimensions: showDimensions,
                            showPerson: showPerson,
                            canvasWidth: 800,
                            canvasHeight: 500,
                            language: i18n.currentLang
                        }
                    };

                    const response = await fetch(`${apiBaseUrl}/api/calculate/optimal-layout-with-preview`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(requestData)
                    });

                    const result = await response.json();
                    if (!result.success) {
                        showError(resultDiv, result.error?.message || 'è®¡ç®—å¤±è´¥');
                        return;
                    }

                    displaySingleOneClickResult(result.data, resultDiv, mainCabinet);
                } else {
                    // å¤šç®±ä½“æ¨¡å¼
                    // å¦‚æœæ˜¯è‹±å°ºï¼Œå…ˆè½¬æ¢ä¸ºç±³
                    if (unit === 'feet') {
                        wallWidth = wallWidth * 0.3048;
                        wallHeight = wallHeight * 0.3048;
                    }
                    
                    const wallWidthMm = Math.round(wallWidth * 1000);
                    const wallHeightMm = Math.round(wallHeight * 1000);

                    const autoAux = document.getElementById('oneclickAutoAux').checked;
                    let auxiliaryCabinets = [];
                    if (autoAux) {
                        const sameFamilyCabinets = getSameFamilyCabinets(mainCabinetId);
                        auxiliaryCabinets = sameFamilyCabinets.map(cab => ({
                            id: cab.id,
                            specs: convertToApiFormat(cab)
                        }));
                    }

                    if (auxiliaryCabinets.length === 0) {
                        showError(resultDiv, 'æ²¡æœ‰å¯ç”¨çš„è¾…åŠ©ç®±ä½“ï¼Œè¯·é€‰æ‹©æœ‰åŒç³»åˆ—ç®±ä½“çš„äº§å“');
                        return;
                    }

                    const requestData = {
                        mainCabinet: {
                            id: mainCabinet.id,
                            specs: convertToApiFormat(mainCabinet)
                        },
                        auxiliaryCabinets: auxiliaryCabinets,
                        wallWidthMm: wallWidthMm,
                        wallHeightMm: wallHeightMm,
                        previewOptions: {
                            showDimensions: showDimensions,
                            showPerson: showPerson,
                            canvasWidth: 800,
                            canvasHeight: 500,
                            language: i18n.currentLang
                        }
                    };

                    const response = await fetch(`${apiBaseUrl}/api/calculate/smart-combination-with-preview`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(requestData)
                    });

                    const result = await response.json();
                    if (!result.success) {
                        showError(resultDiv, result.error?.message || 'è®¡ç®—å¤±è´¥');
                        return;
                    }

                    const previewResult = { success: true, data: result.data.preview };
                    displayOneClickResult(result.data, previewResult, resultDiv, wallWidth, wallHeight);
                }
            } catch (error) {
                showError(resultDiv, `ç½‘ç»œé”™è¯¯: ${error.message}`);
            } finally {
                btn.disabled = false;
                loading.style.display = 'none';
            }
        }

        // å•ç®±ä½“ä¸€é”®ç»“æœæ˜¾ç¤º
        function displaySingleOneClickResult(data, container, cabinet) {
            const calcResult = data.calculationResult || {};
            const resolutionInfo = data.resolution || {};
            
            let powerHtml = '';
            if (calcResult.powerConsumption) {
                powerHtml = `
                <div class="result-card">
                    <h3>âš¡ ${i18n.t('results.powerConsumption')}</h3>
                    <div class="result-grid">
                        <div class="result-item"><div class="label">${i18n.t('results.maxPower')}</div><div class="value">${calcResult.powerConsumption.maximum.toLocaleString()} W</div></div>
                        <div class="result-item"><div class="label">${i18n.t('results.typicalPower')}</div><div class="value">${calcResult.powerConsumption.typical.toLocaleString()} W</div></div>
                        <div class="result-item"><div class="label">${i18n.t('results.totalWeight')}</div><div class="value">${calcResult.physical?.totalWeight?.toFixed(1) || 'N/A'} kg</div></div>
                    </div>
                </div>`;
            }
            
            // ğŸ¯ åˆ†è¾¨ç‡ä¿¡æ¯å¡ç‰‡
            let resolutionHtml = '';
            if (resolutionInfo.mode && resolutionInfo.mode !== 'Custom') {
                resolutionHtml = `
                <div class="result-card">
                    <h3>ğŸ–¥ï¸ ${i18n.t('results.resolutionInfo')}</h3>
                    <div class="result-grid">
                        <div class="result-item">
                            <div class="label">${i18n.t('oneclick.resolutionTarget').replace('ğŸ¯ ', '')}</div>
                            <div class="value">${resolutionInfo.target?.width}Ã—${resolutionInfo.target?.height}</div>
                        </div>
                        <div class="result-item">
                            <div class="label">${i18n.t('oneclick.resolutionActual')}</div>
                            <div class="value">${resolutionInfo.actual?.width}Ã—${resolutionInfo.actual?.height}</div>
                        </div>
                        <div class="result-item">
                            <div class="label">${i18n.t('results.totalPixels')}</div>
                            <div class="value">${resolutionInfo.actual?.totalPixels?.toLocaleString()}</div>
                        </div>
                    </div>
                    <div style="margin-top:10px;padding:8px 12px;background:linear-gradient(135deg, #e8f5e9 0%, #f3e5f5 100%);border-radius:8px;font-size:12px;">
                        <span class="badge badge-success">${resolutionInfo.mode}</span>
                        <span style="margin-left:8px;color:#555;">${resolutionInfo.target?.name || ''}</span>
                    </div>
                </div>`;
            } else {
                // Customæ¨¡å¼ä¹Ÿæ˜¾ç¤ºå®é™…åˆ†è¾¨ç‡
                resolutionHtml = `
                <div class="result-card">
                    <h3>ğŸ–¥ï¸ ${i18n.t('results.resolutionInfo')}</h3>
                    <div class="result-grid">
                        <div class="result-item">
                            <div class="label">${i18n.t('results.totalWidth')}</div>
                            <div class="value">${resolutionInfo.actual?.width?.toLocaleString() || calcResult.pixels?.totalWidth?.toLocaleString()} px</div>
                        </div>
                        <div class="result-item">
                            <div class="label">${i18n.t('results.totalHeight')}</div>
                            <div class="value">${resolutionInfo.actual?.height?.toLocaleString() || calcResult.pixels?.totalHeight?.toLocaleString()} px</div>
                        </div>
                        <div class="result-item">
                            <div class="label">${i18n.t('results.totalPixels')}</div>
                            <div class="value">${(resolutionInfo.actual?.totalPixels || calcResult.pixels?.totalPixels)?.toLocaleString()}</div>
                        </div>
                    </div>
                </div>`;
            }
            
            let html = showSuccess(i18n.t('results.singleSuccess')) + `
                <div class="form-grid">
                    <div>
                        <div class="result-card">
                            <h3>ğŸ“ ${i18n.t('results.availableWall')}</h3>
                            <div class="result-grid">
                                <div class="result-item"><div class="label">${i18n.t('results.screenWidth')}</div><div class="value">${data.roomDimensions.widthM.toFixed(2)} m</div></div>
                                <div class="result-item"><div class="label">${i18n.t('results.screenHeight')}</div><div class="value">${data.roomDimensions.heightM.toFixed(2)} m</div></div>
                            </div>
                        </div>
                        <div class="result-card">
                            <h3>ğŸ“ ${i18n.t('results.layoutRecommendation')}</h3>
                            <div class="result-grid">
                                <div class="result-item"><div class="label">${i18n.t('results.columns')}</div><div class="value">${data.columns}</div></div>
                                <div class="result-item"><div class="label">${i18n.t('results.rows')}</div><div class="value">${data.rows}</div></div>
                                <div class="result-item"><div class="label">${i18n.t('results.totalCabinets')}</div><div class="value">${data.totalCabinets}</div></div>
                            </div>
                        </div>
                        ${resolutionHtml}
                        <div class="result-card">
                            <h3>ğŸ“º ${i18n.t('results.screenDimensions')}</h3>
                            <div class="result-grid">
                                <div class="result-item"><div class="label">${i18n.t('results.screenWidth')}</div><div class="value">${data.screenDimensions.widthM.toFixed(2)} m</div></div>
                                <div class="result-item"><div class="label">${i18n.t('results.screenHeight')}</div><div class="value">${data.screenDimensions.heightM.toFixed(2)} m</div></div>
                                <div class="result-item"><div class="label">${i18n.t('results.screenArea')}</div><div class="value">${data.screenDimensions.areaM2.toFixed(2)} mÂ²</div></div>
                            </div>
                        </div>
                        ${powerHtml}
                    </div>
                    <div>
                        <div class="result-card">
                            <h3>ğŸ–¼ï¸ SVGé¢„è§ˆ</h3>
                            <div class="preview-container has-content" style="min-height:300px;">
                                ${data.preview?.svg || '<div class="empty-state"><div class="empty-state-icon">âŒ</div><p>é¢„è§ˆç”Ÿæˆå¤±è´¥</p></div>'}
                            </div>
                        </div>
                    </div>
                </div>
                <details>
                    <summary>æŸ¥çœ‹åŸå§‹JSONå“åº”</summary>
                    <div class="json-viewer">${JSON.stringify(data, null, 2)}</div>
                </details>
            `;
            
            container.innerHTML = html;
        }

        // å¤šç®±ä½“ä¸€é”®ç»“æœæ˜¾ç¤º
        function displayOneClickResult(calcData, previewResult, container, wallWidthM, wallHeightM) {
            const calcResult = calcData.calculationResult || {};
            
            let html = showSuccess('å¤šç®±ä½“ä¸€é”®è®¡ç®—å®Œæˆï¼') + `
                <div class="form-grid">
                    <div>
                        <div class="result-card">
                            <h3>ğŸ“ å¯ç”¨å¢™é¢</h3>
                            <div class="result-grid">
                                <div class="result-item"><div class="label">å®½åº¦</div><div class="value">${wallWidthM.toFixed(2)} m</div></div>
                                <div class="result-item"><div class="label">é«˜åº¦</div><div class="value">${wallHeightM.toFixed(2)} m</div></div>
                            </div>
                        </div>
                        <div class="result-card">
                            <h3>ğŸ¯ æœ€ä¼˜ç»„åˆæ–¹æ¡ˆ</h3>
                            <div class="result-grid">
                                <div class="result-item">
                                    <div class="label">è¦†ç›–ç‡</div>
                                    <div class="value">${calcData.coveragePercentage || 'N/A'}</div>
                                </div>
                                <div class="result-item">
                                    <div class="label">å®Œå…¨å¡«å……</div>
                                    <div class="value">
                                        <span class="badge ${calcData.isFullyFilled ? 'badge-success' : 'badge-warning'}">
                                            ${calcData.isFullyFilled ? 'æ˜¯' : 'å¦'}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        ${calcData.bestCombination ? `
                        <div class="result-card">
                            <h3>ğŸ“¦ ç®±ä½“æ•°é‡æ˜ç»†</h3>
                            <div class="result-grid">
                                ${calcData.bestCombination.map(cab => {
                                    const cabinet = getCabinetById(cab.id);
                                    return `<div class="result-item">
                                        <div class="label">${cabinet ? cabinet.name : cab.id}</div>
                                        <div class="value">${cab.count} ä¸ª</div>
                                    </div>`;
                                }).join('')}
                            </div>
                        </div>
                        ` : ''}
                        ${calcResult.wallDimensions ? `
                        <div class="result-card">
                            <h3>ğŸ“º å±å¹•å°ºå¯¸</h3>
                            <div class="result-grid">
                                <div class="result-item"><div class="label">å®½åº¦</div><div class="value">${calcResult.wallDimensions.width.toFixed(2)} m</div></div>
                                <div class="result-item"><div class="label">é«˜åº¦</div><div class="value">${calcResult.wallDimensions.height.toFixed(2)} m</div></div>
                                <div class="result-item"><div class="label">é¢ç§¯</div><div class="value">${calcResult.wallDimensions.area.toFixed(2)} mÂ²</div></div>
                            </div>
                        </div>
                        ` : ''}
                        ${calcResult.powerConsumption ? `
                        <div class="result-card">
                            <h3>âš¡ åŠŸè€—ä¸ç‰©ç†å‚æ•°</h3>
                            <div class="result-grid">
                                <div class="result-item"><div class="label">æœ€å¤§åŠŸç‡</div><div class="value">${calcResult.powerConsumption.maximum.toLocaleString()} W</div></div>
                                <div class="result-item"><div class="label">å…¸å‹åŠŸç‡</div><div class="value">${calcResult.powerConsumption.typical.toLocaleString()} W</div></div>
                                <div class="result-item"><div class="label">æ€»é‡é‡</div><div class="value">${calcResult.physical?.totalWeight?.toFixed(1) || 'N/A'} kg</div></div>
                            </div>
                        </div>
                        ` : ''}
                    </div>
                    <div>
                        <div class="result-card">
                            <h3>ğŸ–¼ï¸ SVGé¢„è§ˆ</h3>
                            <div class="preview-container has-content" style="min-height:300px;">
                                ${previewResult.success ? previewResult.data.svg : `<div class="empty-state"><div class="empty-state-icon">âŒ</div><p>é¢„è§ˆç”Ÿæˆå¤±è´¥</p></div>`}
                            </div>
                        </div>
                    </div>
                </div>
                <details>
                    <summary>æŸ¥çœ‹åŸå§‹JSONå“åº”</summary>
                    <div class="json-viewer">${JSON.stringify({ calculation: calcData, preview: previewResult.success ? { width: previewResult.data.width, height: previewResult.data.height } : previewResult }, null, 2)}</div>
                </details>
            `;
            
            container.innerHTML = html;
        }

        // ==================== Preview ç”Ÿæˆ ====================
        function updatePreviewSources() {
            const select = document.getElementById('previewSource');
            const infoDiv = document.getElementById('previewSourceInfo');
            select.innerHTML = '<option value="">è¯·é€‰æ‹©è®¡ç®—ç»“æœ...</option>';
            
            if (calculationResults.layout) {
                select.innerHTML += '<option value="layout">ğŸ“ å•ç®±ä½“å¸ƒå±€ç»“æœ</option>';
            }
            if (calculationResults.smart) {
                select.innerHTML += '<option value="smart">ğŸ§© å¤šç®±ä½“ç»„åˆç»“æœ</option>';
            }
            
            const hasResults = Object.keys(calculationResults).length > 0;
            document.getElementById('previewGenerateBtn').disabled = !hasResults;
            
            if (hasResults) {
                infoDiv.innerHTML = `<div style="padding:10px;background:#e3f2fd;border-radius:8px;color:#1565c0;font-size:12px;">
                    âœ… å·²æœ‰ ${Object.keys(calculationResults).length} ä¸ªè®¡ç®—ç»“æœå¯ç”¨
                </div>`;
            } else {
                infoDiv.innerHTML = `<div style="padding:10px;background:#fff3e0;border-radius:8px;color:#e65100;font-size:12px;">
                    âš ï¸ è¯·å…ˆå®Œæˆè®¡ç®—ä»¥è·å–æ•°æ®
                </div>`;
            }
        }

        async function generatePreview() {
            const btn = document.getElementById('previewGenerateBtn');
            const loading = btn.querySelector('.loading');
            const container = document.getElementById('previewContainer');
            
            const source = document.getElementById('previewSource').value;
            if (!source || !calculationResults[source]) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">âš ï¸</div><p>è¯·å…ˆé€‰æ‹©è®¡ç®—ç»“æœ</p></div>';
                return;
            }

            const width = parseInt(document.getElementById('previewWidth').value);
            const height = parseInt(document.getElementById('previewHeight').value);
            const showDimensions = document.getElementById('previewShowDimensions').checked;
            const showPerson = document.getElementById('previewShowPerson').checked;

            btn.disabled = true;
            loading.style.display = 'inline-block';

            try {
                const calcResult = calculationResults[source];
                let requestData;

                if (source === 'layout') {
                    const cabinet = calcResult.cabinet;
                    const layoutData = calcResult.result;
                    const cols = layoutData.columns;
                    const rows = layoutData.rows;
                    const totalCabinets = cols * rows;
                    
                    const wallWidthM = (cabinet.dimensions.width * cols) / 1000;
                    const wallHeightM = (cabinet.dimensions.height * rows) / 1000;
                    const wallArea = wallWidthM * wallHeightM;
                    
                    const cabinets = [];
                    for (let row = 0; row < rows; row++) {
                        for (let col = 0; col < cols; col++) {
                            cabinets.push({
                                cabinetId: cabinet.id,
                                position: { x: col * cabinet.dimensions.width, y: row * cabinet.dimensions.height },
                                size: { width: cabinet.dimensions.width, height: cabinet.dimensions.height },
                                specs: { dimensions: cabinet.dimensions }
                            });
                        }
                    }

                    requestData = {
                        calculationResult: {
                            wallDimensions: { width: wallWidthM, height: wallHeightM, area: wallArea, diagonal: Math.sqrt(wallWidthM * wallWidthM + wallHeightM * wallHeightM) * 39.37 },
                            cabinetCount: { total: totalCabinets, horizontal: cols, vertical: rows },
                            arrangement: { cabinets: cabinets, strategy: 'single_cabinet', coverage: 1.0 },
                            pixels: {
                                totalWidth: cabinet.display.resolution.width * cols,
                                totalHeight: cabinet.display.resolution.height * rows,
                                totalPixels: cabinet.display.resolution.width * cols * cabinet.display.resolution.height * rows,
                                pixelDensity: (cabinet.display.resolution.width * cols * cabinet.display.resolution.height * rows) / wallArea
                            },
                            powerConsumption: {
                                maximum: cabinet.power.maxPower * totalCabinets,
                                typical: cabinet.power.typicalPower * totalCabinets,
                                standby: (cabinet.power.standbyPower || 5) * totalCabinets
                            },
                            physical: {
                                totalWeight: cabinet.physical.weight * totalCabinets,
                                structuralLoad: (cabinet.physical.weight * totalCabinets) / wallArea
                            }
                        },
                        roomConfig: calcResult.roomConfig,
                        options: { showDimensions, showPerson, canvasWidth: width, canvasHeight: height, format: 'json', language: i18n.currentLang }
                    };
                } else {
                    requestData = {
                        calculationResult: calcResult.result,
                        roomConfig: calcResult.roomConfig,
                        options: { showDimensions, showPerson, canvasWidth: width, canvasHeight: height, format: 'json', language: i18n.currentLang }
                    };
                }

                const response = await fetch(`${apiBaseUrl}/api/preview/svg`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestData)
                });

                const result = await response.json();
                if (result.success) {
                    container.innerHTML = result.data.svg;
                    container.classList.add('has-content');
                } else {
                    container.innerHTML = `<div class="empty-state"><div class="empty-state-icon">âŒ</div><p>ç”Ÿæˆå¤±è´¥: ${result.error?.message || 'æœªçŸ¥é”™è¯¯'}</p></div>`;
                    container.classList.remove('has-content');
                }
            } catch (error) {
                container.innerHTML = `<div class="empty-state"><div class="empty-state-icon">âŒ</div><p>ç½‘ç»œé”™è¯¯: ${error.message}</p></div>`;
                container.classList.remove('has-content');
            } finally {
                btn.disabled = false;
                loading.style.display = 'none';
            }
        }
    </script>
</body>
</html>
